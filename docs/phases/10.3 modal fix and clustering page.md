# Phase 10.3: Modal Layout Fix + Campaign Clustering Page

Two tasks in this document:
1. **Task A:** Fix the modal layout (quick fix)
2. **Task B:** Build the /campaigns clustering page (major feature)

---

# Task A: Fix Preview Modal Layout

**Problem:** The modal data now stretches to the bottom of the page. It lost the columnar layout that made it visually organized.

**Goal:** Restore a clean two-column layout while keeping the new features (4-metric grid, Data Notes, collapsible sections).

## Target Modal Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  #79813                                            [ğŸ“‹] [X]    â”‚
â”‚  â†—ï¸ View in Google Console                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚              [VIDEO/HTML/NATIVE PREVIEW]                       â”‚
â”‚                    720 Ã— 1280 Â· 23s                            â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PERFORMANCE                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  $1,234  â”‚  12,450  â”‚    56    â”‚  0.45%   â”‚                â”‚
â”‚  â”‚  Spend   â”‚  Imps    â”‚  Clicks  â”‚  CTR     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  CPM: $2.50  Â·  CPC: $22.04                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DATA NOTES (if any)                                          â”‚
â”‚  â„¹ Clicks exceed impressions Â· â„¹ Video completion unavailable â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  CREATIVE DETAILS       â”‚  DESTINATION                    â”‚â”‚
â”‚  â”‚                         â”‚                                 â”‚â”‚
â”‚  â”‚  Status: APPROVED       â”‚  Final URL:                     â”‚â”‚
â”‚  â”‚  Format: VIDEO          â”‚  â†’ aliexpress.com/item/...      â”‚â”‚
â”‚  â”‚  Size: 720Ã—1280         â”‚                                 â”‚â”‚
â”‚  â”‚  Advertiser: AliExpress â”‚  Click URLs:                    â”‚â”‚
â”‚  â”‚                         â”‚  â†’ tracking.example.com/...     â”‚â”‚
â”‚  â”‚  TECHNICAL IDS          â”‚  â†’ [+2 more]                    â”‚â”‚
â”‚  â”‚  Account: 299038253     â”‚                                 â”‚â”‚
â”‚  â”‚  Buyer: 299038253       â”‚  TRACKING PARAMS                â”‚â”‚
â”‚  â”‚  Seat: Tuky             â”‚  af_pid: novabeyond             â”‚â”‚
â”‚  â”‚                         â”‚  campaign: Nova574919           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Fixes

1. **Use CSS Grid or Flexbox** for the bottom section:
   ```tsx
   <div className="grid grid-cols-2 gap-4 mt-4">
     <div className="space-y-4">
       {/* Left column: Creative Details + Technical IDs */}
     </div>
     <div className="space-y-4">
       {/* Right column: Destination URLs + Tracking Params */}
     </div>
   </div>
   ```

2. **Constrain modal max-height** with scroll:
   ```tsx
   <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
   ```

3. **Keep collapsible sections but make them inline** - don't let them stretch full width

4. **Data Notes should be horizontal** (inline badges, not vertical list):
   ```tsx
   <div className="flex flex-wrap gap-2">
     {notes.map(note => (
       <span className="inline-flex items-center gap-1 text-xs bg-gray-100 px-2 py-1 rounded">
         <Info className="h-3 w-3" />
         {note.message}
       </span>
     ))}
   </div>
   ```

## File to Modify

`/home/jen/Documents/rtbcat-platform/dashboard/src/components/preview-modal.tsx`

---

# Task B: Campaign Clustering Page (/campaigns)

**Goal:** Allow users to visually group creatives into campaign clusters using drag-and-drop, with auto-clustering by destination URL and country.

## Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAMPAIGNS                                                    [+ New]      â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AUTO-CLUSTER                                                        â”‚  â”‚
â”‚  â”‚  [Cluster by Destination URL]  [AND by Country]  [Reset]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
â”‚  â”‚    â”‚  AliExpress US    â”‚     â”‚  Temu Summer      â”‚                  â”‚  â”‚
â”‚  â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚                  â”‚  â”‚
â”‚  â”‚    â”‚  [card] [card]    â”‚     â”‚  [card] [card]    â”‚                  â”‚  â”‚
â”‚  â”‚    â”‚  [card] [card]    â”‚     â”‚  [card]           â”‚                  â”‚  â”‚
â”‚  â”‚    â”‚  12 creatives     â”‚     â”‚  5 creatives      â”‚                  â”‚  â”‚
â”‚  â”‚    â”‚  $4.2K total      â”‚     â”‚  $1.8K total      â”‚                  â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”                   â”‚  â”‚
â”‚  â”‚    â”‚  Shein Retarget   â”‚           + New                            â”‚  â”‚
â”‚  â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚     â”‚   Campaign       â”‚                   â”‚  â”‚
â”‚  â”‚    â”‚  [card] [card]    â”‚     â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜                   â”‚  â”‚
â”‚  â”‚    â”‚  8 creatives      â”‚                                            â”‚  â”‚
â”‚  â”‚    â”‚  $2.1K total      â”‚                                            â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  UNCLUSTERED (47 creatives)                              [Collapse] â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ card â”‚ â”‚ card â”‚ â”‚ card â”‚ â”‚ card â”‚ â”‚ card â”‚ â”‚ card â”‚ â”‚ card â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Core Features

### 1. Campaign Clusters (Venn-style circles)

Each cluster is a rounded container showing:
- **Name** (editable - double-click to rename)
- **Mini creative thumbnails** (4-6 visible, "+N more" if overflow)
- **Summary stats**: creative count, total spend
- **Drag target** - can drop creatives from unclustered or other clusters

### 2. Auto-Clustering Buttons

```tsx
// Cluster by Destination URL
// Groups creatives where final_url has the same domain+path (ignoring query params)

function clusterByDestinationURL(creatives: Creative[]): Map<string, Creative[]> {
  const clusters = new Map<string, Creative[]>();
  
  creatives.forEach(c => {
    const url = c.final_url || c.display_url || '';
    try {
      const parsed = new URL(url);
      // Use domain + first path segment as key
      const key = `${parsed.hostname}${parsed.pathname.split('/').slice(0, 3).join('/')}`;
      if (!clusters.has(key)) clusters.set(key, []);
      clusters.get(key)!.push(c);
    } catch {
      // Invalid URL - put in "unknown" cluster
      if (!clusters.has('unknown')) clusters.set('unknown', []);
      clusters.get('unknown')!.push(c);
    }
  });
  
  return clusters;
}
```

```tsx
// AND by Country
// Further splits clusters by country (from geo targeting or detected)
// Note: We may not have country data yet - check API response

function clusterByCountry(cluster: Creative[]): Map<string, Creative[]> {
  const subClusters = new Map<string, Creative[]>();
  
  cluster.forEach(c => {
    // Check various places for country info
    const country = c.geo_targeting?.[0] || c.raw_data?.country || 'Unknown';
    if (!subClusters.has(country)) subClusters.set(country, []);
    subClusters.get(country)!.push(c);
  });
  
  return subClusters;
}
```

### 3. New Campaign Button (+)

- Shows as dashed-border empty circle
- Click to create new empty cluster
- Opens name input dialog
- Can then drag creatives into it

### 4. Drag and Drop

Use `@dnd-kit/core` (already popular, accessible):

```bash
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

```tsx
import { DndContext, DragOverlay, closestCenter } from '@dnd-kit/core';
import { SortableContext, useSortable } from '@dnd-kit/sortable';

// Each creative card is draggable
// Each cluster is a droppable zone
// Unclustered section is also droppable (to unassign)
```

### 5. Cluster Naming

- Double-click cluster title to edit
- Auto-suggest name from destination URL domain
- Or manual input

### 6. Split Test Handling

When same URL + country has creatives that should be separate campaigns:
1. User drags some creatives out to new cluster
2. Or uses "Split Selected" button
3. Creates new cluster with subset

## Data Model

### New API Endpoints Needed

```typescript
// GET /campaigns
// Returns all campaigns with their creative IDs

interface Campaign {
  id: string;
  name: string;
  creative_ids: string[];
  created_at: string;
  updated_at: string;
  // Computed on frontend:
  // - total_spend
  // - creative_count
  // - avg_ctr
}

// POST /campaigns
// Create new campaign
{ name: string; creative_ids: string[] }

// PATCH /campaigns/:id
// Update campaign (rename, add/remove creatives)
{ name?: string; creative_ids?: string[] }

// DELETE /campaigns/:id
// Delete campaign (creatives become unclustered)

// POST /campaigns/auto-cluster
// Auto-cluster by URL (and optionally country)
{ by_url: boolean; by_country: boolean }
// Returns suggested clusters, doesn't save until user confirms
```

### Database Schema Addition

```sql
CREATE TABLE IF NOT EXISTS campaigns (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS campaign_creatives (
  campaign_id TEXT NOT NULL,
  creative_id TEXT NOT NULL,
  added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (campaign_id, creative_id),
  FOREIGN KEY (campaign_id) REFERENCES campaigns(id) ON DELETE CASCADE,
  FOREIGN KEY (creative_id) REFERENCES creatives(id) ON DELETE CASCADE
);
```

## File Structure

```
dashboard/src/app/campaigns/
  page.tsx              # Main campaigns page
  
dashboard/src/components/campaigns/
  campaign-cluster.tsx  # Individual cluster component (droppable)
  creative-mini-card.tsx # Small draggable creative card
  unclustered-pool.tsx  # The unclustered creatives section
  auto-cluster-bar.tsx  # The auto-cluster buttons bar
  rename-dialog.tsx     # Dialog for renaming clusters

creative-intelligence/api/
  main.py               # Add campaign endpoints
  
creative-intelligence/storage/
  sqlite_store.py       # Add campaign table operations
```

## Implementation Order

1. **Backend first:**
   - Add campaigns table to SQLite
   - Add CRUD endpoints for campaigns
   - Add auto-cluster endpoint (returns suggestions)

2. **Frontend - static layout:**
   - Create /campaigns page structure
   - Create cluster components (no drag yet)
   - Show unclustered creatives

3. **Frontend - auto-cluster:**
   - Implement "Cluster by URL" button
   - Implement "AND by Country" button
   - Show suggested clusters

4. **Frontend - drag and drop:**
   - Install dnd-kit
   - Make creatives draggable
   - Make clusters droppable
   - Handle drop events (API calls)

5. **Frontend - polish:**
   - Rename clusters
   - Create new empty cluster
   - Delete cluster
   - Animations

## Mini Card Component

For the clusters, we need a smaller version of the creative card:

```tsx
// creative-mini-card.tsx
// 60x60px square with just thumbnail + tiny spend badge

interface MiniCardProps {
  creative: Creative;
  isDragging?: boolean;
}

function CreativeMiniCard({ creative, isDragging }: MiniCardProps) {
  return (
    <div className={cn(
      "w-16 h-16 rounded overflow-hidden relative cursor-grab",
      "border border-gray-200 bg-gray-50",
      isDragging && "opacity-50 ring-2 ring-blue-500"
    )}>
      {/* Thumbnail */}
      <img 
        src={getThumbnail(creative)} 
        alt="" 
        className="w-full h-full object-cover"
      />
      
      {/* Tiny spend badge */}
      {creative.has_data && (
        <div className="absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] px-1">
          {formatSpend(creative.performance?.total_spend_micros)}
        </div>
      )}
    </div>
  );
}
```

## Cluster Component

```tsx
// campaign-cluster.tsx

interface ClusterProps {
  campaign: Campaign;
  creatives: Creative[];
  onRename: (id: string, name: string) => void;
  onRemoveCreative: (campaignId: string, creativeId: string) => void;
}

function CampaignCluster({ campaign, creatives, onRename, onRemoveCreative }: ClusterProps) {
  const { setNodeRef, isOver } = useDroppable({ id: campaign.id });
  const [isEditing, setIsEditing] = useState(false);
  
  const totalSpend = creatives.reduce((sum, c) => 
    sum + (c.performance?.total_spend_micros || 0), 0
  );
  
  const visibleCreatives = creatives.slice(0, 6);
  const overflow = creatives.length - 6;
  
  return (
    <div 
      ref={setNodeRef}
      className={cn(
        "w-64 p-4 rounded-2xl border-2 bg-white",
        isOver ? "border-blue-500 bg-blue-50" : "border-gray-200"
      )}
    >
      {/* Header - editable name */}
      {isEditing ? (
        <input 
          autoFocus
          defaultValue={campaign.name}
          onBlur={(e) => {
            onRename(campaign.id, e.target.value);
            setIsEditing(false);
          }}
          onKeyDown={(e) => e.key === 'Enter' && e.currentTarget.blur()}
          className="text-lg font-semibold w-full border-b border-blue-500 outline-none"
        />
      ) : (
        <h3 
          className="text-lg font-semibold cursor-pointer hover:text-blue-600"
          onDoubleClick={() => setIsEditing(true)}
        >
          {campaign.name}
        </h3>
      )}
      
      {/* Creative grid */}
      <div className="grid grid-cols-3 gap-1 mt-3">
        {visibleCreatives.map(c => (
          <DraggableCreative key={c.id} creative={c} />
        ))}
        {overflow > 0 && (
          <div className="w-16 h-16 rounded bg-gray-100 flex items-center justify-center text-sm text-gray-500">
            +{overflow}
          </div>
        )}
      </div>
      
      {/* Stats */}
      <div className="mt-3 text-sm text-gray-600">
        {creatives.length} creatives Â· {formatSpend(totalSpend)}
      </div>
    </div>
  );
}
```

## Testing Checklist

1. [ ] Modal layout is back to two columns
2. [ ] Modal has max-height with scroll
3. [ ] Data Notes display horizontally
4. [ ] /campaigns page loads
5. [ ] "Cluster by Destination URL" creates clusters
6. [ ] "AND by Country" further splits clusters
7. [ ] Can drag creative from unclustered to cluster
8. [ ] Can drag creative between clusters
9. [ ] Can drag creative back to unclustered
10. [ ] Can rename cluster by double-clicking
11. [ ] Can create new empty cluster with +
12. [ ] Cluster shows mini thumbnails + stats
13. [ ] Changes persist (saved to backend)

---

## Priority Order

**Task A (1-2 hours):**
1. Fix modal two-column layout
2. Constrain modal height
3. Make Data Notes horizontal

**Task B (6-10 hours):**
1. Backend: campaigns table + CRUD endpoints
2. Backend: auto-cluster endpoint
3. Frontend: page layout + static clusters
4. Frontend: auto-cluster buttons
5. Frontend: drag and drop
6. Frontend: rename + new cluster

---

## Report Back

After each task, provide:
1. Summary of changes
2. Any deviations and why
3. Screenshots if possible
4. Issues encountered
5. What's ready for testing